{"ast":null,"code":"var uid = require('uid2');\n/**\n * Creates an instance of `SessionStore`.\n *\n * This is the state store implementation for the OAuth2Strategy used when\n * the `state` option is enabled.  It generates a random state and stores it in\n * `req.session` and verifies it when the service provider redirects the user\n * back to the application.\n *\n * This state store requires session support.  If no session exists, an error\n * will be thrown.\n *\n * Options:\n *\n *   - `key`  The key in the session under which to store the state\n *\n * @constructor\n * @param {Object} options\n * @api public\n */\n\n\nfunction SessionStore(options) {\n  if (!options.key) {\n    throw new TypeError('Session-based state store requires a session key');\n  }\n\n  this._key = options.key;\n}\n/**\n * Store request state.\n *\n * This implementation simply generates a random string and stores the value in\n * the session, where it will be used for verification when the user is\n * redirected back to the application.\n *\n * @param {Object} req\n * @param {Function} callback\n * @api protected\n */\n\n\nSessionStore.prototype.store = function (req, callback) {\n  if (!req.session) {\n    return callback(new Error('OAuth 2.0 authentication requires session support when using state. Did you forget to use express-session middleware?'));\n  }\n\n  var key = this._key;\n  var state = uid(24);\n\n  if (!req.session[key]) {\n    req.session[key] = {};\n  }\n\n  req.session[key].state = state;\n  callback(null, state);\n};\n/**\n * Verify request state.\n *\n * This implementation simply compares the state parameter in the request to the\n * value generated earlier and stored in the session.\n *\n * @param {Object} req\n * @param {String} providedState\n * @param {Function} callback\n * @api protected\n */\n\n\nSessionStore.prototype.verify = function (req, providedState, callback) {\n  if (!req.session) {\n    return callback(new Error('OAuth 2.0 authentication requires session support when using state. Did you forget to use express-session middleware?'));\n  }\n\n  var key = this._key;\n\n  if (!req.session[key]) {\n    return callback(null, false, {\n      message: 'Unable to verify authorization request state.'\n    });\n  }\n\n  var state = req.session[key].state;\n\n  if (!state) {\n    return callback(null, false, {\n      message: 'Unable to verify authorization request state.'\n    });\n  }\n\n  delete req.session[key].state;\n\n  if (Object.keys(req.session[key]).length === 0) {\n    delete req.session[key];\n  }\n\n  if (state !== providedState) {\n    return callback(null, false, {\n      message: 'Invalid authorization request state.'\n    });\n  }\n\n  return callback(null, true);\n}; // Expose constructor.\n\n\nmodule.exports = SessionStore;","map":{"version":3,"sources":["/home/astitva/Desktop/basic-react/node_modules/passport-oauth2/lib/state/session.js"],"names":["uid","require","SessionStore","options","key","TypeError","_key","prototype","store","req","callback","session","Error","state","verify","providedState","message","Object","keys","length","module","exports"],"mappings":"AAAA,IAAIA,GAAG,GAAGC,OAAO,CAAC,MAAD,CAAjB;AAEA;;;;;;;;;;;;;;;;;;;;;AAmBA,SAASC,YAAT,CAAsBC,OAAtB,EAA+B;AAC7B,MAAI,CAACA,OAAO,CAACC,GAAb,EAAkB;AAAE,UAAM,IAAIC,SAAJ,CAAc,kDAAd,CAAN;AAA0E;;AAC9F,OAAKC,IAAL,GAAYH,OAAO,CAACC,GAApB;AACD;AAED;;;;;;;;;;;;;AAWAF,YAAY,CAACK,SAAb,CAAuBC,KAAvB,GAA+B,UAASC,GAAT,EAAcC,QAAd,EAAwB;AACrD,MAAI,CAACD,GAAG,CAACE,OAAT,EAAkB;AAAE,WAAOD,QAAQ,CAAC,IAAIE,KAAJ,CAAU,uHAAV,CAAD,CAAf;AAAsJ;;AAE1K,MAAIR,GAAG,GAAG,KAAKE,IAAf;AACA,MAAIO,KAAK,GAAGb,GAAG,CAAC,EAAD,CAAf;;AACA,MAAI,CAACS,GAAG,CAACE,OAAJ,CAAYP,GAAZ,CAAL,EAAuB;AAAEK,IAAAA,GAAG,CAACE,OAAJ,CAAYP,GAAZ,IAAmB,EAAnB;AAAwB;;AACjDK,EAAAA,GAAG,CAACE,OAAJ,CAAYP,GAAZ,EAAiBS,KAAjB,GAAyBA,KAAzB;AACAH,EAAAA,QAAQ,CAAC,IAAD,EAAOG,KAAP,CAAR;AACD,CARD;AAUA;;;;;;;;;;;;;AAWAX,YAAY,CAACK,SAAb,CAAuBO,MAAvB,GAAgC,UAASL,GAAT,EAAcM,aAAd,EAA6BL,QAA7B,EAAuC;AACrE,MAAI,CAACD,GAAG,CAACE,OAAT,EAAkB;AAAE,WAAOD,QAAQ,CAAC,IAAIE,KAAJ,CAAU,uHAAV,CAAD,CAAf;AAAsJ;;AAE1K,MAAIR,GAAG,GAAG,KAAKE,IAAf;;AACA,MAAI,CAACG,GAAG,CAACE,OAAJ,CAAYP,GAAZ,CAAL,EAAuB;AACrB,WAAOM,QAAQ,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEM,MAAAA,OAAO,EAAE;AAAX,KAAd,CAAf;AACD;;AAED,MAAIH,KAAK,GAAGJ,GAAG,CAACE,OAAJ,CAAYP,GAAZ,EAAiBS,KAA7B;;AACA,MAAI,CAACA,KAAL,EAAY;AACV,WAAOH,QAAQ,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEM,MAAAA,OAAO,EAAE;AAAX,KAAd,CAAf;AACD;;AAED,SAAOP,GAAG,CAACE,OAAJ,CAAYP,GAAZ,EAAiBS,KAAxB;;AACA,MAAII,MAAM,CAACC,IAAP,CAAYT,GAAG,CAACE,OAAJ,CAAYP,GAAZ,CAAZ,EAA8Be,MAA9B,KAAyC,CAA7C,EAAgD;AAC9C,WAAOV,GAAG,CAACE,OAAJ,CAAYP,GAAZ,CAAP;AACD;;AAED,MAAIS,KAAK,KAAKE,aAAd,EAA6B;AAC3B,WAAOL,QAAQ,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEM,MAAAA,OAAO,EAAE;AAAX,KAAd,CAAf;AACD;;AAED,SAAON,QAAQ,CAAC,IAAD,EAAO,IAAP,CAAf;AACD,CAvBD,C,CAyBA;;;AACAU,MAAM,CAACC,OAAP,GAAiBnB,YAAjB","sourcesContent":["var uid = require('uid2');\n\n/**\n * Creates an instance of `SessionStore`.\n *\n * This is the state store implementation for the OAuth2Strategy used when\n * the `state` option is enabled.  It generates a random state and stores it in\n * `req.session` and verifies it when the service provider redirects the user\n * back to the application.\n *\n * This state store requires session support.  If no session exists, an error\n * will be thrown.\n *\n * Options:\n *\n *   - `key`  The key in the session under which to store the state\n *\n * @constructor\n * @param {Object} options\n * @api public\n */\nfunction SessionStore(options) {\n  if (!options.key) { throw new TypeError('Session-based state store requires a session key'); }\n  this._key = options.key;\n}\n\n/**\n * Store request state.\n *\n * This implementation simply generates a random string and stores the value in\n * the session, where it will be used for verification when the user is\n * redirected back to the application.\n *\n * @param {Object} req\n * @param {Function} callback\n * @api protected\n */\nSessionStore.prototype.store = function(req, callback) {\n  if (!req.session) { return callback(new Error('OAuth 2.0 authentication requires session support when using state. Did you forget to use express-session middleware?')); }\n\n  var key = this._key;\n  var state = uid(24);\n  if (!req.session[key]) { req.session[key] = {}; }\n  req.session[key].state = state;\n  callback(null, state);\n};\n\n/**\n * Verify request state.\n *\n * This implementation simply compares the state parameter in the request to the\n * value generated earlier and stored in the session.\n *\n * @param {Object} req\n * @param {String} providedState\n * @param {Function} callback\n * @api protected\n */\nSessionStore.prototype.verify = function(req, providedState, callback) {\n  if (!req.session) { return callback(new Error('OAuth 2.0 authentication requires session support when using state. Did you forget to use express-session middleware?')); }\n\n  var key = this._key;\n  if (!req.session[key]) {\n    return callback(null, false, { message: 'Unable to verify authorization request state.' });\n  }\n\n  var state = req.session[key].state;\n  if (!state) {\n    return callback(null, false, { message: 'Unable to verify authorization request state.' });\n  }\n\n  delete req.session[key].state;\n  if (Object.keys(req.session[key]).length === 0) {\n    delete req.session[key];\n  }\n\n  if (state !== providedState) {\n    return callback(null, false, { message: 'Invalid authorization request state.' });\n  }\n\n  return callback(null, true);\n};\n\n// Expose constructor.\nmodule.exports = SessionStore;\n"]},"metadata":{},"sourceType":"script"}